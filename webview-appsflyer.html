<!DOCTYPE html>
<html>
	<head>
	<script>
		/* Query String Processing*/
			////Saving query string first, we'll need it within the snippet
			//var querystring = decodeURIComponent(document.location.search);
			//var adTrEn = false;
			//if (querystring.substring(1).split('&')[4].split("=")[1] == "true"){adTrEn = true}; //booleanizing
			//// Saving context and integration objects for later
			//var segment_context = {
			//	"device":
			//		{
			//			"type": querystring.substring(1).split('&')[1].split("=")[1],
			//			"advertisingId": querystring.substring(1).split('&')[2].split("=")[1],
			//			"adTrackingEnabled": adTrEn,
			//			"model": querystring.substring(1).split('&')[5].split("=")[1]
			//		},
			//	"app":
			//		{
			//		"name": querystring.substring(1).split('&')[6].split("=")[1],
			//		"namespace": querystring.substring(1).split('&')[7].split("=")[1],
			//		"version": querystring.substring(1).split('&')[8].split("=")[1]
			//		},
			//	"os":
			//		{
			//		"name": querystring.substring(1).split('&')[9].split("=")[1],
			//		"version": querystring.substring(1).split('&')[10].split("=")[1]
			//		},
			//	"library":
			//		{
      			//		"name": "analytics-node",
			//		"version": "3.0.0"
			//		}
			//};
			//var segment_integrations = {
			//"AppsFlyer":
			//  {
			//  "appsFlyerId": querystring.substring(1).split('&')[3].split("=")[1]
			//  }
			//};
		
		/* Segment Snippet */
			!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
			//analytics.load("yRlbVBBNZlmxkOTk0HwS3JHjMrXPZAgB"); // js
			//analytics.load("JWiAqlQlRHIMLQ3GX24NF2zFDdvi34br"); // project
			analytics.load("kqzana1ex4BP0a3XmByBlIM77twD1W3Y"); //node.js

			/* First Segment call ia a page(). But it won't be sent to AppsFlyer: 
			   AppsFlyer is not accepting neither page() nor screen()
			   we will probably remoe it
			*/
			analytics.page('WebView For AppsFlyer Test');
		 }}();
		
	</script>
	
	</head>
	
	
	
<body>
	
	<a href="https://stesegment.github.io/webview-appsflyer?anonymousId=aaa111bb-22cc-33dd-44ee-55fff66ggg77&type=android&advertisingId=advert26-idfa-idfa-idfa-advertadvert&appsflyerId=44E02FA8-F7F0-4307-8228-F7B2733E9192&adTrackingEnabled=true&model=ONEPLUS%20A6013&app_name=SegTest&app_namespace=com.segment.stefano.segmenttest&app_version=1.0&os_name=Android&os_version=9">
	Load this page with the right query string
	</a>
	
<h1 style="font-family:verdana;color:red;">Test Web View for AppsFlyer</h1>
<p>On this page we retrieve some IDs collected within the Native App:</p>
	<ul>
		<li>anonymousId</li>
		<li>device type</li>
		<li>advertising Id</li>
		<li>AppsFlyer Id</li>
		<li>adTrackingEnabled</li>
		<li>device model</li>
		<li>app name</li>
		<li>app namespace</li>
		<li>app version</li>
		<li>os name</li>
		<li>os version</li>
	</ul>
<p>from the query string and pass them on into a track() and an identify() call.</p>
<p>The native app has previously passed all these collected IDs to the Web View as "intent extras"</p>



<h4 style="font-family:verdana;">The query string looks like:</h4>

<pre style="font-size:60%;color:blue">
	<script type="text/javascript">
		document.write(window.location.search);
	</script>
</pre>

<script type="text/javascript">
function printQs() {
	var output = {};
	var qs = decodeURIComponent(document.location.search.substring(1));
	qs = qs.split('&');
	for (var i = 0; i < qs.length; i++) {
		var tokens = qs[i].split('=');
		//output[tokens[0].toLowerCase()] = tokens[1];
		document.write(tokens[0]+" = "+tokens[1]+"\n");
		//document.write("\n");
	}
	//return output;
}
</script>
	
<h4 style="font-family:verdana;">and contains:</h4>
	<pre style="font-size:100%;color:blue">
		<script type="text/javascript">
			document.write("\n");
			printQs();
		</script>
	</pre>

<!-- Segment Calls -->
<script type="text/javascript">
	
	// analytics.identify([userId], [traits], [options], [callback]);
	//analytics.identify("appsflyeruser",{},{
	//	context: segment_context,
	//	integrations: segment_integrations
	//});
	//analytics.track("Web View Event Occurred",{},{
	//	context: segment_context,
	//	integrations: segment_integrations
	//});
</script>
	

<script type="text/javascript">
	var eventProperties = "{\"my_property\":\"my_value\", \"url\": \""+ decodeURIComponent(document.location.href)+"\"}";
	segment_webview.track("WebView Event Occurred",eventProperties);
</script>

</body>
</html>
